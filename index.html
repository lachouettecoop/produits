<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />

    <title>Produits — La Chouette Coop</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.3.1/themes/algolia-min.css"
      integrity="sha256-HB49n/BZjuqiCtQQf49OdZn63XuKFaxcIHWf0HNKte8="
      crossorigin="anonymous"
    />
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <style>
      .state {
        border-left: 5px solid;
        padding-left: 1rem;
      }
      /**
        - 0: "Vente au Lab"
        - 200: "Vente au Supermarché"
        - 500: "Déréférencé"
        - 700: "Requalification en cours"
        - 1000: "Archivé"
      */
      .state--0 {
        border-color: green;
      }
      .state--200 {
        border-color: orange;
        opacity: 0.7;
      }
      .state--500, .state--700, .state--1000 {
        opacity: 0.3;
        border-color: gray;
      }
    </style>
  </head>

  <body>
    <div class="container mx-auto">
      <h1 class="mt-5 mb-10 text-4xl">
        Les produits de La Chouette Coop
      </h1>

      <div class="flex mb-4">
        <div class="w-1/4 p-2 pt-0">
          <h2 class="mb-5 text-2xl">
            Filtres
          </h2>

          <h3 class="mt-6 mb-2 text-xl">Prix</h3>
          <div id="price" class="ml-2 mr-6"></div>

          <h3 class="mt-6 mb-2 text-xl">Catégorie</h3>
          <div id="categories"></div>

          <h3 class="mt-6 mb-2 text-xl">Labels</h3>
          <div id="labels"></div>

          <h3 class="mt-6 mb-2 text-xl">Fournisseurs</h3>
          <div id="suppliers"></div>

          <h3 class="mt-6 mb-2 text-xl">Statut</h3>
          <div id="states"></div>

          <div id="powered-by" class="mt-8"></div>
        </div>

        <div class="w-3/4 p-2 pt-0">
          <div class="mb-5">
            <div id="searchbox"></div>
            <div id="current-refinements" class="my-2"></div>
            <div id="stats"></div>
          </div>

          <div class="my-5">
            <div id="hits"></div>
          </div>

          <div id="pagination"></div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/algoliasearch@4.0.0/dist/algoliasearch-lite.umd.js"
      integrity="sha256-MfeKq2Aw9VAkaE9Caes2NOxQf6vUa8Av0JqcUXUGkd0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.0.0/dist/instantsearch.production.min.js"
      integrity="sha256-6S7q0JJs/Kx4kb/fv0oMjS855QTz5Rc2hh9AkIUjUsk="
      crossorigin="anonymous"
    ></script>
    <script>
      const searchClient = algoliasearch(
        "M6AKDBX36Z",
        "200ad253b958794d0ff8a2a187d74560"
      );

      const search = instantsearch({
        indexName: "produits",
        searchClient,
        routing: true
      });

      search.addWidgets([
        instantsearch.widgets.configure({
          hitsPerPage: 50,
          filters: "price > 0"
        }),

        instantsearch.widgets.searchBox({
          container: "#searchbox"
        }),
        instantsearch.widgets.currentRefinements({
          container: "#current-refinements"
        }),
        instantsearch.widgets.stats({
          container: "#stats"
        }),

        instantsearch.widgets.rangeSlider({
          container: "#price",
          attribute: "price"
        }),
        instantsearch.widgets.refinementList({
          container: "#labels",
          attribute: "labels",
          showMore: true
        }),
        instantsearch.widgets.refinementList({
          container: "#suppliers",
          attribute: "supplier",
          showMore: true
        }),
        instantsearch.widgets.refinementList({
          container: "#states",
          attribute: "saleState"
        }),
        instantsearch.widgets.hierarchicalMenu({
          container: "#categories",
          attributes: [
            "categories.lvl1",
            "categories.lvl2",
            "categories.lvl3",
            "categories.lvl4",
            "categories.lvl5",
            "categories.lvl6"
          ]
        }),

        instantsearch.widgets.pagination({
          container: "#pagination"
        }),

        instantsearch.widgets.hits({
          container: "#hits",
          templates: {
            item(hit) {
              const image = hit.thumbnailPath
                ? `https://raw.githubusercontent.com/lachouettecoop/produits/master/${hit.thumbnailPath}`
                : "https://via.placeholder.com/128?text=Aucune+image";

              return `
                <article class="state state--${hit.saleStateScore} flex">
                  <div class="w-1/5 pr-2">
                    <img
                      class="object-left"
                      alt=""
                      src="${image}" />
                  </div>

                  <div class="w-3/5">
                    <p class="text-lg font-semibold">${hit.name}</p>
                    <p class="text-xs mt-2">
                      <span class="shadow px-2 py-1 mr-2 bg-green-600 text-white">${hit.saleState}</span> ${hit.barCode}</p>

                    <ul class="mt-4 flex flex-row items-stretch">
                      <li class="flex-1" title="Fournisseur">${hit.supplier}</li>
                      <li class="flex-1" title="Labels">${hit.labels}</li>
                      <li class="flex-1" title="Origine">${hit.origin}</li>
                    </ul>
                  </div>

                  <div class="w-1/5">
                    <p class="text-4xl">${hit.price}€</p>
                    <div class="flex mt-2 items-center">
                      <p>Stock</p>
                      <p class="ml-2 px-2 py-1 font-bold bg-gray-700 text-white" title="Quantité en stock">${hit.qtyInStock}</p>
                    </div>
                  </div>
                </article>
              `;
            }
          },
          cssClasses: {
            item: "w-full"
          }
        }),

        instantsearch.widgets.poweredBy({
          container: "#powered-by"
        })
      ]);

      search.start();
    </script>
  </body>
</html>
